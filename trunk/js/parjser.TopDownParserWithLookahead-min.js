(function(){if(typeof parjser==="undefined")parjser={};parjser._EOF={type:"_EOF"};parjser._DEBUGGER={type:"_DEBUGGER"};if(!parjser.grammars)parjser.grammars={}})();
(function(){parjser.Exception=function(a,d){this.type=a;d&&this.initFromTokenizer(d);return this};parjser.Exception.prototype={initFromTokenizer:function(a){this.offset=a.offset;this.text=a.originalText;this.initLineAndColumnInfo()},initLineAndColumnInfo:function(){var a=this.offset,d=this.text.substr(0,a),b=d.replace(/\n/g,"");this.line=1+d.length-b.length;b=d.lastIndexOf("\n");this.column=a-b;this.lastLine=d.substr(b,this.column)},toString:function(){return this.type+" at line "+this.line+", column "+
this.column+": "+this.lastLine}};parjser.SyntaxErrorException=function(a,d,b){this.initFromTokenizer(a);this.lastToken=d;this.lastSymbol=b};parjser.SyntaxErrorException.prototype=new parjser.Exception("SyntaxErrorException");parjser.SyntaxErrorException.prototype.toString=function(){return parjser.Exception.prototype.toString.call(this)+"\nwhile parsing "+this.lastSymbol}})()(function(){parjser.RegexTokenizer=function(a){this.init(a);return this};parjser.RegexTokenizer.prototype={init:function(a){this.tokens=
a.tokens?a.tokens:{};this.tokenNames=[null];this.groups=[null];this.ignoreCase=a.ignoreCase===true?true:false;this.ignoredTokens=a.ignoreTokens?a.ignoreTokens:{};this.offset=this.text=null;this.makeRegex(false)},makeRegex:function(a){var d,b=this.tokens,f="",c,g=0,i=this.tokenNames,n=this.groups;for(d in b){if(f!=="")f+="|";c=b[d].toString();f+="("+c.substr(1,c.length-2)+")";if(a)RegExp("^"+f,(this.ignoreCase?"i":"")+"g");else{i.push(d);c=c.replace(/\\\\/g,"");c=c.replace(/\\\(/g,"");c=c.replace(/\(\?!/g,
"");g++;n.push(g);g+=c.length-c.replace(/\(/g,"").length}}if(!a)try{this.regex=RegExp(f,(this.ignoreCase?"i":"")+"g")}catch(u){this.makeRegex(true)}},isIgnoredToken:function(a){return a.type in this.ignoredTokens},setText:function(a){this.text=this.originalText=a;this.offset=0},next:function(){var a=this.text,d=this.offset,b,f,c,g,i;if(d>=a.length)return parjser._EOF;if((a=this.regex.exec(a))===null)this.throwNoMatchException();else a.index!==this.offset&&this.throwNoMatchException();b=a[0];f=b.length;
i=this.groups;this.offset+=f;g=1;for(c=a.length;g<c;g++)if(a[i[g]]){token=this.tokenNames[g];return{text:b,len:f,off:d,type:token}}this.throwNoMatchException()},nextToken:function(){for(var a;this.isIgnoredToken(a=this.next()););return a},throwNoMatchException:function(){throw new parjser.Exception("NoMatchFound",this);}}}());
(function(){parjser.GrammarCompiler=function(){};parjser.GrammarCompiler.compile=function(a){var d,b,f,c,g=a.rules?a.rules:{},i={},n={tokens:null,tokenizer:null,rules:null,prune:a.prune?true:false};b=(a.parserClass?a.parserClass:parjser.TopDownParser).prototype;var u=b.parseEmpty,w=b.parseChoice,x=b.parseSequence,y=b.parseToken,B=function(h,e){var j,k,m,o,q,v,s,l;e||(e={first:{}});e.originalRule=h;if(h instanceof Array){j=h.length;if(j===0)e.func=u;else{m=[];e.ruleParts=m;if(h[0]==="|"){q=w;k=1}else{q=
x;k=0}e.func=q}for(v=0;k<j;k++){o=h[k];if(typeof o==="undefined")throw"Undefined rulepart at index "+k+" in rule "+JSON.stringify(h);l=o=B(o);k=k;var D=h.length,A=void 0,z=void 0;A=k+1;if(A<D){z=h[A];if(typeof z==="string"){k=A;switch(z){case "?":l.minOccurs=0;l.maxOccurs=1;break;case "+":l.minOccurs=1;l.maxOccurs=Number.POSITIVE_INFINITY;break;case "*":l.minOccurs=0;l.maxOccurs=Number.POSITIVE_INFINITY;break;default:if((match=/^\{(\d+)(,(\d+))?\}$/.exec(z))&&match[0]===z){l.minCardinality=match[1]?
parseInt(match[1],10):1;l.maxCardinality=match[3]?parseInt(match[3],10):1}else k--}}}if(typeof l.minOccurs==="undefined")l.minOccurs=1;if(typeof l.maxOccurs==="undefined")l.maxOccurs=1;k=k;l=o.first;if(q===w||q===x&&v===0)for(s in l){e.first[s]||(e.first[s]={});e.first[s][m.length]=true}v+=o.minOccurs;e.ruleParts.push(o)}if(v===0)e.minOccurs=0}else if(typeof h==="string")if(c[h]){e.token=h;e.func=y;l={};l[h]={"0":true};e.first=l}else if(g[h]){j=i[h];if(!j){j={symbol:h,minOccurs:1,maxOccurs:1,first:{}};
j.first[h]={"0":true};i[h]=j;B(g[h],j)}for(s in j)e[s]=j[s]}else throw h+" is neither a token nor a symbol.";else if(h===null)e.func=u;return e},C=function(h){var e,j,k,m;h.fixed=true;e=h.first;for(j in e){indexes=e[j];if(!(indexes instanceof Array)){m=[];for(k in indexes)m.push(parseInt(k,10));e[j]=m.sort()}}if(h=h.ruleParts){e=h.length;for(j=0;j<e;j++){k=h[j];k.fixed||C(k)}}};if(a.tokens)c=a.tokens;else{c={};r={};for(d in g){b=g[d];if(b instanceof RegExp)c[d]=b;else r[d]=b}g=r}n.tokens=c;d=a.tokenizer?
a.tokenizer:new parjser.RegexTokenizer({tokens:c,ignoreCase:a.ignoreCase,ignoreTokens:a.ignoreTokens});n.tokenizer=d;if(a.startSymbol)f=a.startSymbol;else for(f in g)break;if(!g[f])throw"No rule found for symbol "+f;n.startSymbol=f;B(f);(function(){var h,e,j,k,m,o,q,v,s;for(h in i){e=i[h];k={};e=e.first;for(j in e)if(m=i[j])k[j]=m;for(j in k){s=e[j];delete e[j];if(j!==h){m=k[j];m=m.first;for(o in m)if(!i[o]){q=e[o];if(!q){q={};e[o]=q}for(v in s)q[v]=true}}}}})();(function(){var h,e;for(h in i){e=
i[h];C(e)}})();n.rules=i;n.compiled=true;return n}})()(function(){parjser.TopDownParser=function(a){this.grammar=a.compiled?a:parjser.GrammarCompiler.compile(a);this.tokenizer=this.grammar.tokenizer;this.prune=this.grammar.prune;return this};parjser.TopDownParser.prototype={initTokenBuffer:function(){this.tokenBuffer=[];this.tokenBufferPointer=-1},nextToken:function(){var a;a=++this.tokenBufferPointer;var d=this.tokenBuffer;if(a<d.length)a=d[a];else{a=this.tokenizer.nextToken();d.push(a)}return a},
parseRule:function(a,d){for(var b,f=this.prune,c,g=0,i=a.func,n=a.maxOccurs;g<n;g++){c=this.tokenBufferPointer;b={children:[]};if(i.call(this,a,b)){b.offset=this.tokenizer.offset;b.tokenBufferPointer=c;b.type=a;b.parentNode=d;if(f){c=b.children.length;if(c===1)b=b.children[0]}d.children.push(b)}else{this.tokenBufferPointer=c;b.children=null;b.parentNode=null;b.type=null;break}}return g>=a.minOccurs},parseEmpty:function(){return true},parseToken:function(a,d){var b=this.nextToken();if(b.type===a.token){d.token=
b;return true}else return false},parseEOF:function(){return this.nextToken()===parjser._EOF},parseChoice:function(a,d){for(var b=0,f=a.ruleParts,c=f.length;b<c;b++)if(this.parseRule(f[b],d))return true;return false},parseSequence:function(a,d){for(var b=0,f=a.ruleParts,c=f.length;b<c;b++)if(!this.parseRule(f[b],d))return false;return true},initParse:function(a,d){if(!d)if(!(d=this.grammar.startSymbol))throw"No symbol specified or implied";var b=this.grammar.rules[d];b={func:parjser.TopDownParser.prototype.parseSequence,
ruleParts:[b,parjser._EOF],minOccurs:1,maxOccurs:1};this.tokenizer.setText(a);this.initTokenBuffer();this.tree={children:[]};return b},parse:function(a,d){this.parseRule(this.initParse(a,d),this.tree)||this.throwSyntaxErrorException();return this.tree.children[0].children[0]},throwSyntaxErrorException:function(){var a=this.tokenBuffer,d=a.length;throw new parjser.SyntaxErrorException(this.tokenizer,d?a[d-1]:null,this.lastSymbol?this.lastSymbol:this.currentSymbol);}};parjser._EOF.func=parjser.TopDownParser.prototype.parseEOF;
parjser._EOF.minOccurs=1;parjser._EOF.maxOccurs=1}())(function(){parjser._EOF.first={};parjser._EOF.first[parjser._EOF.type]=[0];var a=parjser.TopDownParser,d=a.prototype;parjser.TopDownParserWithLookahead=function(b){b.parserClass=parjser.TopDownParserWithLookahead;a.call(this,b)};parjser.TopDownParserWithLookahead.prototype={initTokenBuffer:d.initTokenBuffer,nextToken:d.nextToken,throwSyntaxErrorException:d.throwSyntaxErrorException,parse:d.parse,parseEOF:d.parseEOF,parseEmpty:d.parseEmpty,nextToken:d.nextToken,
parseToken:function(b,f){var c=this.lookaheadToken;if(c.type===b.token){f.token=c;this.lookaheadToken=this.nextToken();return true}else return false},initParse:function(b,f){var c=d.initParse.call(this,b,f);c.func=this.parseSequence;c.first={};var g;for(g in c.ruleParts[0].first)c.first[g]=[0];this.lookaheadToken=this.nextToken();return c},parseRule:function(b,f){var c,g=b.first[this.lookaheadToken.type],i,n,u=0,w,x,y;if(g){n=this.prune;w=b.func;for(x=b.maxOccurs;u<x;u++){y=this.tokenBufferPointer;
c=this.lookaheadToken;i={children:[]};if(w.call(this,b,i,g)){i.offset=this.tokenizer.offset;i.tokenBufferPointer=y;i.type=b;i.parentNode=f;if(n){c=i.children;if(c.length===1)i=c[0]}f.children.push(i)}else{this.tokenBufferPointer=y;this.lookaheadToken=c;i.children=null;i.parentNode=null;i.type=null;break}}}return u>=b.minOccurs},parseChoice:function(b,f,c){b=b.ruleParts;var g,i=c.length;for(g=0;g<i;g++)if(this.parseRule(b[c[g]],f))return true;return false},parseSequence:function(b,f,c){b=b.ruleParts;
for(var g=b.length,i=c.length;0<i;){for(c=c[0];c<g;c++)if(!this.parseRule(b[c],f))return false;return true}}}}());
