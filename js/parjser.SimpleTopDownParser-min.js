(function(){if(typeof parjser==="undefined")parjser={};parjser._EOF={type:"_EOF"};parjser._DEBUGGER={type:"_DEBUGGER"};if(!parjser.grammars)parjser.grammars={}})();
(function(){parjser.Exception=function(a,b){this.type=a;b&&this.initFromTokenizer(b);return this};parjser.Exception.prototype={initFromTokenizer:function(a){this.offset=a.offset;this.text=a.originalText;this.initLineAndColumnInfo()},initLineAndColumnInfo:function(){var a=this.offset,b=this.text.substr(0,a),c=b.replace(/\n/g,"");this.line=1+b.length-c.length;c=b.lastIndexOf("\n");this.column=a-c;this.lastLine=b.substr(c,this.column)},toString:function(){return this.type+" at line "+this.line+", column "+
this.column+": "+this.lastLine}};parjser.SyntaxErrorException=function(a,b,c){this.initFromTokenizer(a);this.lastToken=b;this.lastSymbol=c};parjser.SyntaxErrorException.prototype=new parjser.Exception("SyntaxErrorException");parjser.SyntaxErrorException.prototype.toString=function(){return parjser.Exception.prototype.toString.call(this)+"\nwhile parsing "+this.lastSymbol}})();
(function(){parjser.RegexTokenizer=function(a){this.init(a);return this};parjser.RegexTokenizer.prototype={init:function(a){this.tokens=a.tokens?a.tokens:{};this.tokenNames=[null];this.groups=[null];this.ignoreCase=a.ignoreCase===true?true:false;this.ignoredTokens=a.ignoreTokens?a.ignoreTokens:{};this.offset=this.text=null;this.makeRegex(false)},makeRegex:function(a){var b,c=this.tokens,e="",f,d=0,g=this.tokenNames,h=this.groups;for(b in c){if(e!=="")e+="|";f=c[b].toString();e+="("+f.substr(1,f.length-
2)+")";if(a)RegExp("^"+e,(this.ignoreCase?"i":"")+"g");else{g.push(b);f=f.replace(/\\\\/g,"");f=f.replace(/\\\(/g,"");f=f.replace(/\(\?[!:=]/g,"");d++;h.push(d);d+=f.length-f.replace(/\(/g,"").length}}if(!a)try{this.regex=RegExp(e,(this.ignoreCase?"i":"")+"g")}catch(i){this.makeRegex(true)}},isIgnoredToken:function(a){return a.type in this.ignoredTokens},setText:function(a){this.text=this.originalText=a;this.offset=0},next:function(){var a=this.text,b=this.offset,c,e,f,d,g;if(b>=a.length)return parjser._EOF;
if((a=this.regex.exec(a))===null)this.throwNoMatchException();else a.index!==this.offset&&this.throwNoMatchException();c=a[0];e=c.length;g=this.groups;this.offset+=e;d=1;for(f=a.length;d<f;d++)if(a[g[d]])return{text:c,len:e,off:b,type:this.tokenNames[d]};this.throwNoMatchException()},nextToken:function(){for(var a;this.isIgnoredToken(a=this.next()););return a},throwNoMatchException:function(){throw new parjser.Exception("NoMatchFound",this);}}})();
(function(){parjser.SimpleTopDownParser=function(a){this.init(a);this.prune=a.prune;return this};parjser.SimpleTopDownParser.prototype={init:function(a){this.tokens=a.tokens?a.tokens:{};this.tokenizer=a.tokenizer?a.tokenizer:new parjser.RegexTokenizer(a);this.rules=a.rules?a.rules:{};this.startSymbol=a.startSymbol;this.tokenBufferPointer=this.tokenBuffer=null},isToken:function(a){return a in this.tokens},getRule:function(a){var b=this.rules[a];if(!b)throw'No rule found for symbol "'+a+'"';return b},
initTokenBuffer:function(){this.tokenBuffer=[];this.tokenBufferPointer=-1},nextToken:function(){var a;a=++this.tokenBufferPointer;var b=this.tokenBuffer;if(a<b.length)a=b[a];else{a=this.tokenizer.nextToken();b.push(a)}return a},parseRule:function(a,b,c,e){var f,d,g={offset:this.tokenizer.offset,tokenBufferPointer:this.tokenBufferPointer};if(a instanceof Array)d=a.length===0?this.parseEmpty():a[0]==="|"?this.parseChoice(a,g):this.parseSequence(a,g);else if(typeof a==="string")d=a.length===0?this.parseEmpty():
this.parseSymbol(a,g);else if(a===null)d=this.parseEmpty();else if(a===parjser._EOF)if(this.nextToken()===parjser._EOF)f=d=true;else d=false;else if(a===parjser._DEBUGGER){d=true;debugger}else{debugger;throw"Invalid rule: "+JSON.stringify(a);}if(d){g.type=a;g.rulePartIndex=c;g.recurrenceIndex=e;if(b&&f!==true){if(!b.children)b.children=[];g.parentNode=b;b.children.push(g)}}else this.tokenBufferPointer=g.tokenBufferPointer;return d},parseToken:function(a,b){var c=this.nextToken(),e;if(c.type===a){e=
true;b.token=c}else e=false;return e},parseEmpty:function(){return true},parseSequence:function(a,b){var c=a.length,e,f,d,g,h,i;for(e=0;e<c;e++){f=a[e];if(e+1<c){g=a[e+1];switch(g){case "?":h=0;i=1;break;case "*":h=0;i=Number.POSITIVE_INFINITY;break;case "+":h=1;i=Number.POSITIVE_INFINITY;break;default:if((d=/\{(\d+)(,(\d+))?\}/.exec(g))&&d[0]===g){h=d[1]?parseInt(d[1],10):1;i=d[3]?parseInt(d[3],10):1}else{g=null;i=h=1}}}else{g=null;i=h=1}for(d=0;d<h;d++)if(!this.parseRule(f,b,e,d))return false;for(;d<
i;d++)if(!this.parseRule(f,b,e,d))break;g!==null&&e++}return true},parseChoice:function(a,b){var c,e=a.length,f;for(c=1;c<e;c++){f=a[c];if(this.parseRule(f,b,c))return true}return false},parseSymbol:function(a,b){var c;if(this.isToken(a))c=this.parseToken(a,b);else{if(this.tokenBufferPointer===this.tokenBuffer.length-1)this.lastSymbol=a;c=this.getRule(a);c=this.parseRule(c,b)}return c},parse:function(a,b){if(!b)if(this.startSymbol)b=this.startSymbol;else throw"No symbol specified or implied";var c=
[b,parjser._EOF];this.tokenizer.setText(a);this.initTokenBuffer();this.tree={};this.lastSymbol=null;this.parseRule(c,this.tree)||this.throwSyntaxErrorException();return this.tree.children[0].children[0]},throwSyntaxErrorException:function(){var a=this.tokenBuffer,b=a.length;throw new parjser.SyntaxErrorException(this.tokenizer,b?a[b-1]:null,this.lastSymbol?this.lastSymbol:this.currentSymbol);}}})();
